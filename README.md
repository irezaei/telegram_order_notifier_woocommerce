# اسکریپت ارسال اعلان سفارشات ووکامرس به تلگرام

این اسکریپت PHP مستقل است که می‌توانید آن را در سرور ثالث (سوم) قرار دهید و به صورت خودکار سفارشات جدید ووکامرس را به تلگرام شما ارسال کند.

## ویژگی‌ها

- ✅ اجرا در سرور ثالث (نیازی به نصب در وردپرس نیست)
- ✅ استفاده از REST API وردپرس
- ✅ قابل اجرا به صورت Cron Job
- ✅ جلوگیری از ارسال تکراری
- ✅ سیستم لاگ برای ردیابی
- ✅ پشتیبانی از فارسی

## نیازمندی‌ها

- PHP 7.2 یا بالاتر
- فعال بودن cURL در PHP
- دسترسی به اینترنت
- Application Password در وردپرس

## نصب و راه‌اندازی

### 1. دریافت Application Password در وردپرس

1. به پنل مدیریت وردپرس بروید
2. به **Users > Profile** بروید
3. به پایین صفحه بروید و در بخش **Application Passwords**:
   - یک نام برای رمز عبور انتخاب کنید (مثلاً: Telegram Bot)
   - روی **Add New Application Password** کلیک کنید
   - رمز عبور ایجاد شده را کپی کنید (فقط یک بار نمایش داده می‌شود)

### 2. دریافت توکن ربات تلگرام

1. به تلگرام بروید و به [@BotFather](https://t.me/BotFather) پیام دهید
2. دستور `/newbot` را ارسال کنید
3. نام ربات و نام کاربری آن را وارد کنید
4. توکن دریافتی را کپی کنید

### 3. دریافت شناسه چت (Chat ID)

1. به [@userinfobot](https://t.me/userinfobot) در تلگرام پیام دهید
2. شناسه عددی که دریافت می‌کنید را کپی کنید (مثال: `123456789`)

### 4. تنظیم فایل config.php

فایل `config.php` را باز کنید و اطلاعات زیر را وارد کنید:

```php
define('WP_SITE_URL', 'https://yoursite.com'); // آدرس سایت وردپرس
define('WP_API_USER', 'your_api_username');     // نام کاربری وردپرس
define('WP_API_PASS', 'your_api_password');     // Application Password
define('TELEGRAM_BOT_TOKEN', 'your_bot_token'); // توکن ربات تلگرام
define('TELEGRAM_CHAT_ID', 'your_chat_id');     // شناسه چت تلگرام
```

### 5. آپلود فایل‌ها به سرور ثالث

فایل‌های زیر را به سرور ثالث خود آپلود کنید:
- `telegram_order_notifier.php`
- `config.php`

**نکته امنیتی:** فایل `config.php` را در پوشه‌ای خارج از public_html قرار دهید یا از `.htaccess` برای محافظت استفاده کنید.

### 6. تنظیم Cron Job

برای اجرای خودکار اسکریپت، یک Cron Job تنظیم کنید:

#### در cPanel:
1. به بخش **Cron Jobs** بروید
2. یک Cron Job جدید ایجاد کنید:
   - **Minute:** `*/5` (هر 5 دقیقه)
   - **Hour:** `*`
   - **Day:** `*`
   - **Month:** `*`
   - **Weekday:** `*`
   - **Command:** `/usr/bin/php /path/to/telegram_order_notifier.php`

#### در خط فرمان:
```bash
*/5 * * * * /usr/bin/php /path/to/telegram_order_notifier.php
```

#### یا می‌توانید از وب هاست خود به صورت دستی اجرا کنید:
```
https://your-third-server.com/telegram_order_notifier.php
```

## تست

برای تست اسکریپت:

1. فایل `config.php` را با اطلاعات صحیح پر کنید
2. اسکریپت را به صورت دستی اجرا کنید:
   ```bash
   php telegram_order_notifier.php
   ```
3. یا از مرورگر به آدرس فایل بروید
4. یک سفارش تست در ووکامرس ایجاد کنید
5. اسکریپت را دوباره اجرا کنید
6. پیام را در تلگرام بررسی کنید

## فایل‌های لاگ

اسکریپت دو فایل لاگ ایجاد می‌کند:

- `orders_log.txt`: لیست سفارشات ارسال شده (برای جلوگیری از ارسال تکراری)
- `notifier.log`: لاگ کامل اجرا و خطاها

## عیب‌یابی

### خطا: "تنظیمات ناقص است"
- بررسی کنید که تمام فیلدهای `config.php` پر شده باشند

### خطا: "خطا در اتصال به وردپرس"
- بررسی کنید که `WP_SITE_URL` صحیح باشد
- بررسی کنید که Application Password درست باشد
- بررسی کنید که REST API ووکامرس فعال باشد

### خطا: "خطا در ارسال به تلگرام"
- بررسی کنید که توکن ربات صحیح باشد
- بررسی کنید که شناسه چت صحیح باشد
- بررسی کنید که ربات تلگرام فعال باشد

### سفارشات ارسال نمی‌شوند
- بررسی کنید که Cron Job به درستی تنظیم شده باشد
- فایل `notifier.log` را بررسی کنید
- بررسی کنید که سفارشات در وضعیت `pending`, `processing` یا `on-hold` باشند

## امنیت

- فایل `config.php` را در پوشه‌ای امن قرار دهید
- از `.htaccess` برای محافظت از فایل‌ها استفاده کنید
- Application Password را به صورت امن نگهداری کنید
- دسترسی به فایل‌های لاگ را محدود کنید

## پشتیبانی

در صورت بروز مشکل، فایل `notifier.log` را بررسی کنید تا خطاها را مشاهده کنید.

## مجوز

این اسکریپت به صورت رایگان و متن باز ارائه می‌شود.
